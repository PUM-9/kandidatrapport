\chapter{Analys av punktmolnsregistrering}
\label{cha:indiv-report-karlsson}
\chapterprecis{\LARGE{---- Michael Karlsson ----}}


\section{Inledning}
\label{sec:introduction-karlsson}

%% Skriv här
I detta kapitel behandlas Michael Karlssons undersökning av olika registreringsalgoritmer och de problem gruppen stött på i samband med registrering av punktmoln.

\subsection{Syfte}
\label{sec:purpose-karlsson}

%% Skriv här
Syftet med denna delen är att väga olika algoritmer mot varandra och hur väl de fungerade för det projekt som beskrivs i rapporten samt vilka problem gruppen hade med de olika algoritmer som testades. Gruppens tillvägagångssätt för val av algoritm undersöks också.


\subsection{Frågeställning}
\label{sec:issue-karlsson}

\begin{itemize}
	\item Hur skapar man ett enhetligt punktmoln från enstaka bilder från en fast \newline avståndskamera?
	\item Hur gör man för att välja algoritm och hur resonerade gruppen när de valde ICP?	
\end{itemize}

\subsection{Definitioner och förkortningar}
\label{sec:definitions-acronyms-karlsson}

Här listas de definitioner och förkortningar som används i kapitlet.

\begin{itemize}
	\item Point Cloud Library - Ett C++ bibliotek för hantering av punktmoln.
	\item PCL - Point Cloud Library.
	\item Iterative Closest Point - En algoritm för punktmolnsregistrering.
	\item ICP - Iterative Closest Point.
	\item JR-MPC - Joint Registration of Multiple Point Clouds
	\item SeqICP - SequentialICP
\end{itemize}


\subsection{Avgränsningar}
\label{sec:limits-karlsson}
Denna rapport kommer begränsas till hur processen fungerat med den hårdvara som vi blivit tilldelade. För registrering finns en ofantlig mängd algoritmer och tillvägagångssätt. Denna utredning kommer begränsas till de metoder som använts inom projektet. 


\section{Bakgrund}
\label{sec:background-karlsson}
I ett tidigt stadie av projektet upptäckte vi att en stor del skulle handla om att få registreringen att funka bra. Tidiga tester visade dessutom att meshningen, en annan del som tidigt verkade väldigt stor, som görs efter registreringen var förhållandevis enkel att utföra. Meshning innebär att man, utifrån det kompletta punktmolnet, skapar en vattentät 3D-modell. Jag blev intresserad efter att ha jobbat en del med tidiga försök till registrering och beslutade mig för att djupdyka i ämnet.


\section{Teori}
\label{sec:theory-karlsson}

När man vill återskapa fysiska objekt digitalt fastnar man oftast i att det inte finns några bra verktyg för att läsa in tredimensionella objekt. Man behöver då ta flera bilder av objektet från olika vinklar för att kunna sammanfoga dessa till det fulla objektet. Det finns många metoder för detta, exempelvis Kinect Fusion. Den metod vi använt oss av har dock bestått av en avståndskamera på linjärenhet med objektet monterat på ett rotationsbord med 2 rotationsaxlar. Med hjälp av detta rotationsbord kan men förhållandevis enkelt se hela objektet från en fast punkt. Dessa punktmoln har vi haft som moln att enhetligt registrera till en komplett representation av objektet som skannats.


\subsection{Registrering}

Registrering är den generella metoden att sätta ihop två eller flera punktmoln till ett koordinatsystem med all information från indatan. Det finns väldigt många olika algoritmer för att utföra detta såsom till exempel ICP, \textit{Iterative Closest Point} eller GMMReg. De flesta tillgängliga algoritmer har någon form av svaghet eller nackdel. Till exempel så lider ICP av så kallad \textit{felutbredning} och JR-MPC \textit{Joint Registration of Multiple Point Clouds} lider av längre körtid.[]

\subsection{Kinect Fusion}

Kinect fusion använder sig av Microsofts egna avstånds- och RGB-kamera, Kinect, för att mappa upp ett 3D objekt i den verkliga världen. Avståndskameran mäter upp punktmolnet för scenen framför den samtidigt som den synkroniserade RGB-kameran ger färgdata till varje punkt. 
Varje punktmoln som Kinect kameran skickar består av ca 307 000 punkter. Det kan jämföras med hårdvaran som vi använt oss av där maximala antalet punkter i en skanning är ca 786 000 punkter. De punktmoln som vi arbetat med har dock generellt innehållit ca 30-60 000 punkter efter filtrering av skräpdata.

\section{Metod}
\label{sec:method-karlsson}

Initialt gjordes en litteraturstudie för att hitta information om hur man registrerar. PCL ger en bra sammanfattning men utöver det finns inte jättemånga relevanta källor. PCL ger också många handledningsexempel med exempelkod som blev utgångspunkten för utbildningen om registrering i gruppen. Då utredningen är begränsad till framförallt ICP och JR-MPC begränsas antalet ytterligare. Det finns enormt många varianter av ICP, såsom SeqICP, Point-to-Plane ICP Point-to-Point ICP m.fl. Jag har inte hittat någon referens i PCL, vars ICP-implementation gruppen använder sig av, till vilken av dessa PCL implementerar. På grund av det här kommer en generell ICP algoritmen utvärderas. JR-MPC är resultatet av en forskningsstudie som tagit fram algoritmen och därmed finns enbart den källa som används här för den algoritmen. Det finns snarlika algoritmer med enbart sina forskningsdokument som källa men dessa kommer alltså inte behandlas här.



\section{Resultat}
\label{sec:results-karlsson}

%% Skriv här
Vi började med att införskaffa oss en uppsättning punktmoln på objektet och försökte med den exempelkod vi hittat sätta ihop punktmolnen. De första objektet vi började testa med var en porslinskyrka pga att det var det enda vi hade att tillgå. Efter ett par veckor fick vi en låda med träklossar som vi började arbeta med och som blev vårat primära mål att registrera då dessa rekommenderades av kund som lättare objekt.
 Den primära algoritm vi använde var ICP. Valet av ICP var initialt baserat på att det var den algoritm vi hittade först samt den som vi fick tag på exempelkod för. Vi gjorde dock vissa begränsade tester med JR-MPC som rekommenderades av kunden CVL. Då JR-MPC inte vid tidpunkten gav bättre resultat än den metod som användes samt betydligt mer manuellt arbete för att kunna köra algoritmen så lades snabbt arbetet med JR-MPC på is. Mer fokus lades på att jobba vidare med ICP och ungefär halvvägs in i projektet hade vi en algoritm som funkade på ca 20 av de 36 punktmoln på objektet. Efter det hamnade ett 

\subsection{ICP}
ICP är en optimeringsalgoritm som försöker minimera det totala avståndet från varje punkt i ursprungsmolnet till varje punkt i målmolnet. Det ger en bästa körtid på $ \mathit{O(n^2)} $
\subsection{JR-MPC}
JR-MPC använder så kallade GMM, \textit{Gaussian Mixture Model}, för att registrera objektet. Exakt hur matematiken bakom algoritmen ser ut och fungerar är utanför omfattningen av denna rapport men grundläggande principer följer. Genom att ta fram sannolikheten för att en punkt ligger inom objektet som ska 

\subsection{3DCopy metoden}
Under utvecklingsarbetet och problemfaser med registreringen planerade gruppen om och försökte med en annan lösningsmetod till registreringsproblemet. Då registreringsalgoritmerna som använts helt ignorerar den kända datan om hur mycket rotation som skett mellan varje skanning så blev det fokus för våran metod. 

\section{Diskussion}
\label{sec:discussion-karlsson}

\subsection{Diskussion om Metod}

\subsection{Diskussion om Resultat}

\subsection{Diskussion om Metod}


\section{Slutsatser}
\label{sec:conclusions-karlsson}

%% Skriv här

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% karlsson-report.tex ends here
